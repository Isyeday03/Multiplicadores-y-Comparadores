import React, { useState } from 'react';
import { Calculator, Zap } from 'lucide-react';

const BinaryMultiplier = () => {
  const [a1, setA1] = useState(0);
  const [a0, setA0] = useState(0);
  const [b1, setB1] = useState(0);
  const [b0, setB0] = useState(0);

  // Compuertas AND para productos parciales
  const andGate = (x, y) => x && y ? 1 : 0;

  // Half Adder
  const halfAdder = (x, y) => {
    const sum = x ^ y; // XOR para suma
    const carry = x && y ? 1 : 0; // AND para acarreo
    return { sum, carry };
  };

  // Cálculo de productos parciales
  const P00 = andGate(a0, b0);
  const P01 = andGate(a1, b0);
  const P10 = andGate(a0, b1);
  const P11 = andGate(a1, b1);

  // Suma de productos parciales
  const P0 = P00;
  
  // Bit P1: suma P01 + P10
  const ha1 = halfAdder(P01, P10);
  const P1 = ha1.sum;
  const C1 = ha1.carry;

  // Bit P2: suma P11 + C1
  const ha2 = halfAdder(P11, C1);
  const P2 = ha2.sum;
  const P3 = ha2.carry;

  const resultado = P3 * 8 + P2 * 4 + P1 * 2 + P0;
  const valorA = a1 * 2 + a0;
  const valorB = b1 * 2 + b0;

  const BitButton = ({ value, onChange, label }) => (
    <button
      onClick={() => onChange(value === 0 ? 1 : 0)}
      className={`w-16 h-16 text-2xl font-bold rounded-lg transition-all ${
        value === 1
          ? 'bg-blue-500 text-white shadow-lg scale-105'
          : 'bg-gray-200 text-gray-600'
      }`}
    >
      {value}
    </button>
  );

  const AndGate = ({ input1, input2, output, label }) => (
    <div className="flex flex-col items-center p-3 bg-white rounded-lg shadow-md">
      <div className="text-xs text-gray-600 mb-1">{label}</div>
      <div className="flex gap-2 mb-2">
        <span className={`w-6 h-6 rounded flex items-center justify-center text-xs ${
          input1 ? 'bg-blue-500 text-white' : 'bg-gray-300'
        }`}>{input1}</span>
        <span className="text-xs">AND</span>
        <span className={`w-6 h-6 rounded flex items-center justify-center text-xs ${
          input2 ? 'bg-blue-500 text-white' : 'bg-gray-300'
        }`}>{input2}</span>
      </div>
      <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${
        output ? 'bg-green-500 text-white' : 'bg-gray-300'
      }`}>{output}</div>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
      <div className="max-w-6xl mx-auto">
        <div className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Calculator className="w-10 h-10 text-indigo-600" />
            <h1 className="text-4xl font-bold text-gray-800">
              Multiplicador Binario 2×2 bits
            </h1>
          </div>
          <p className="text-gray-600">Simulación de circuito digital con compuertas AND y Half Adders</p>
        </div>

        {/* Entradas */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
            <Zap className="w-6 h-6 text-yellow-500" />
            Entradas (Click para cambiar)
          </h2>
          
          <div className="grid grid-cols-2 gap-8">
            <div>
              <h3 className="text-lg font-semibold text-gray-700 mb-3">
                Multiplicando A = {a1}{a0} ({valorA})
              </h3>
              <div className="flex gap-3">
                <div className="text-center">
                  <div className="text-sm text-gray-500 mb-1">A₁</div>
                  <BitButton value={a1} onChange={setA1} />
                </div>
                <div className="text-center">
                  <div className="text-sm text-gray-500 mb-1">A₀</div>
                  <BitButton value={a0} onChange={setA0} />
                </div>
              </div>
            </div>

            <div>
              <h3 className="text-lg font-semibold text-gray-700 mb-3">
                Multiplicador B = {b1}{b0} ({valorB})
              </h3>
              <div className="flex gap-3">
                <div className="text-center">
                  <div className="text-sm text-gray-500 mb-1">B₁</div>
                  <BitButton value={b1} onChange={setB1} />
                </div>
                <div className="text-center">
                  <div className="text-sm text-gray-500 mb-1">B₀</div>
                  <BitButton value={b0} onChange={setB0} />
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Productos Parciales */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">
            Paso 1: Productos Parciales (Compuertas AND)
          </h2>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <AndGate input1={a0} input2={b0} output={P00} label="P₀₀ = A₀·B₀" />
            <AndGate input1={a1} input2={b0} output={P01} label="P₀₁ = A₁·B₀" />
            <AndGate input1={a0} input2={b1} output={P10} label="P₁₀ = A₀·B₁" />
            <AndGate input1={a1} input2={b1} output={P11} label="P₁₁ = A₁·B₁" />
          </div>
        </div>

        {/* Diagrama de Multiplicación */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">
            Paso 2: Alineación de Productos Parciales
          </h2>
          <div className="font-mono text-center bg-gray-50 p-6 rounded-lg text-lg">
            <div className="mb-2 text-gray-600">Multiplicación binaria:</div>
            <div className="text-blue-600 font-bold">
              {' '.repeat(12)}{a1} {a0}
            </div>
            <div className="text-blue-600 font-bold">
              {' '.repeat(10)}× {b1} {b0}
            </div>
            <div className="border-t-2 border-gray-400 my-2"></div>
            <div className="text-green-600">
              {' '.repeat(10)}{P01} {P00}  ← A × B₀
            </div>
            <div className="text-green-600">
              {' '.repeat(8)}{P11} {P10}    ← A × B₁ (shift)
            </div>
            <div className="border-t-2 border-gray-400 my-2"></div>
            <div className="text-red-600 font-bold text-xl">
              {' '.repeat(8)}{P3} {P2} {P1} {P0}
            </div>
          </div>
        </div>

        {/* Sumadores */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">
            Paso 3: Suma con Half Adders
          </h2>
          <div className="space-y-4">
            <div className="bg-purple-50 p-4 rounded-lg">
              <h3 className="font-semibold text-purple-800 mb-2">Half Adder 1 (Bit P₁)</h3>
              <div className="flex items-center gap-4 flex-wrap">
                <span>P₀₁ ({P01}) + P₁₀ ({P10})</span>
                <span className="text-purple-600">→</span>
                <span>Suma: {P1}</span>
                <span>Acarreo C₁: {C1}</span>
              </div>
            </div>

            <div className="bg-indigo-50 p-4 rounded-lg">
              <h3 className="font-semibold text-indigo-800 mb-2">Half Adder 2 (Bit P₂)</h3>
              <div className="flex items-center gap-4 flex-wrap">
                <span>P₁₁ ({P11}) + C₁ ({C1})</span>
                <span className="text-indigo-600">→</span>
                <span>Suma: {P2}</span>
                <span>Acarreo P₃: {P3}</span>
              </div>
            </div>
          </div>
        </div>

        {/* Resultado */}
        <div className="bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl shadow-lg p-8 text-white">
          <h2 className="text-3xl font-bold mb-4 text-center">Resultado Final</h2>
          <div className="text-center">
            <div className="text-6xl font-bold mb-4">
              {P3}{P2}{P1}{P0}
            </div>
            <div className="text-2xl">
              {valorA} × {valorB} = {resultado}
            </div>
            <div className="text-lg mt-2 opacity-90">
              Binario: {P3}{P2}{P1}{P0}₂ = Decimal: {resultado}₁₀
            </div>
          </div>
        </div>

        {/* Componentes del Circuito */}
        <div className="bg-white rounded-xl shadow-lg p-6 mt-6">
          <h2 className="text-xl font-bold text-gray-800 mb-3">Componentes Utilizados</h2>
          <ul className="space-y-2 text-gray-700">
            <li>✓ 4 Compuertas AND (productos parciales)</li>
            <li>✓ 2 Half Adders (HA) para las sumas</li>
            <li>✓ Entradas: 4 bits (A₁A₀, B₁B₀)</li>
            <li>✓ Salidas: 4 bits (P₃P₂P₁P₀)</li>
          </ul>
        </div>
      </div>
    </div>
  );
};

export default BinaryMultiplier;
